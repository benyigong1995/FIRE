<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>财务自由计算器</title>
    <link rel="icon" href="/web/favicon.svg" type="image/svg+xml" />
    <link rel="icon" href="/web/favicon.png" type="image/png" />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <header>
      <h1>财务自由计算器</h1>
      <p>以今日购买力计算每月可支配收入，并展示资产余额曲线</p>
    </header>

    <main>
      <section class="card">
        <form id="calc-form">
          <div class="grid">
            <label>
              <span>当前年龄（岁）</span>
              <input type="number" id="age" min="0" step="1" value="30" required />
            </label>
            <label>
              <span>当前存款</span>
              <input type="number" id="savings" min="0" step="1000" value="7000000" required />
            </label>
            <label>
              <span>预期寿命（岁）</span>
              <input type="number" id="life" min="1" step="1" value="90" required />
            </label>
            <label>
              <span>年化通胀率（%）</span>
              <input type="number" id="inflation" min="0" step="0.1" value="3.0" required />
            </label>
            <label>
              <span>年化理财回报率（%）</span>
              <input type="number" id="ret" min="0" step="0.1" value="5.0" required />
            </label>
          </div>
          <div class="actions">
            <button type="submit">计算</button>
            <button type="reset" id="reset">重置</button>
          </div>
        </form>

        <div class="result">
          <div>
            <span class="muted">每月可支配收入（以今日购买力）：</span><span class="info" data-tip="按真实收益率计算的固定月金额，用今天的价格度量；名义金额会随通胀逐月增长。">?</span>
            <strong id="monthly">—</strong>
          </div>
          <div id="reverseGroup" class="reverse-group" style="display:none;">
            <div class="reverse-title muted">目标反推</div>
            <div>
              <span class="muted">反推所需当前存款（今日购买力）：</span><span class="info" data-tip="今天需要具备的购买力等值；与账面金额不同，不含未来通胀。">?</span>
              <strong id="requiredSavings">—</strong>
            </div>
            <div>
              <span class="muted">退休时所需存款（按退休当年标价）：</span><span class="info" data-tip="退休当年的账面金额（包含通胀），约等于“按今日价格”×(1+通胀)^年数。">?</span>
              <strong id="requiredAtRetire">—</strong>
            </div>
          </div>
        </div>

        <div class="reverse-inputs">
          <div class="reverse-title muted">目标反推</div>
          <div class="grid">
            <label>
              <span>期望月开销（今日购买力）</span>
              <input type="number" id="desiredMonthly" min="0" step="100" placeholder="例如 15000" />
            </label>
            <label>
              <span>目标退休年龄（岁）</span>
              <input type="number" id="retireAge" min="0" step="1" placeholder="留空则默认=当前年龄" />
            </label>
          </div>
          <div class="actions">
            <button type="button" id="reverseBtn">推测所需存款</button>
          </div>
        </div>
      </section>

      <section class="card">
        <h2>月度收入与资产余额</h2>
        <div class="chart-actions"><button type="button" id="exportPng">导出图表 PNG</button></div>
        <canvas id="balanceChart" height="140"></canvas>
      </section>
    </main>

    <footer>
      <small>当前模型假设在预期寿命末期余额（购买力）为 0。</small>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script type="module" src="app.js"></script>
  </body>
</html>
