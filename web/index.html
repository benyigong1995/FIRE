<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>财务自由计算器 - FIRE Calculator</title>
    <meta name="description" content="计算你需要多少存款才能实现财务自由，以今日购买力计算每月可支配收入，支持目标反推、图表可视化。" />
    
    <!-- Open Graph / 微信分享 -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://fire-zeta.vercel.app/" />
    <meta property="og:title" content="财务自由计算器 - FIRE Calculator" />
    <meta property="og:description" content="计算你需要多少存款才能实现财务自由。输入年龄、存款、预期寿命，立即得出每月可支配收入！" />
    <meta property="og:image" content="https://fire-zeta.vercel.app/og-image.svg" />
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="财务自由计算器 - FIRE Calculator" />
    <meta name="twitter:description" content="计算你需要多少存款才能实现财务自由。输入年龄、存款、预期寿命，立即得出每月可支配收入！" />
    <meta name="twitter:image" content="https://fire-zeta.vercel.app/og-image.svg" />
    
    <link rel="icon" href="./favicon.svg" type="image/svg+xml" />
    <link rel="icon" href="./favicon.png" type="image/png" />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <header>
      <div class="header-row">
        <h1>财务自由计算器</h1>
        <button type="button" id="darkModeToggle" class="dark-mode-toggle" title="切换深色模式">🌙</button>
      </div>
      <p>以今日购买力计算每月可支配收入，并展示资产余额曲线</p>
    </header>

    <main>
      <section class="card">
        <form id="calc-form">
          <div class="grid">
            <label>
              <span>当前年龄（岁）</span>
              <input type="number" id="age" min="0" step="1" value="30" required />
            </label>
            <label>
              <span>当前存款</span>
              <input type="text" id="savings" inputmode="numeric" value="7,000,000" required data-raw="7000000" />
              <span class="format-hint" id="savingsHint"></span>
            </label>
            <label>
              <span>预期寿命（岁）</span>
              <input type="number" id="life" min="1" step="1" value="90" required />
            </label>
            <label>
              <span>年化通胀率（%）</span>
              <div class="slider-group">
                <input type="range" id="inflationSlider" min="0" max="10" step="0.1" value="3.0" class="slider" />
                <input type="number" id="inflation" min="0" step="0.1" value="3.0" required class="slider-number" />
              </div>
            </label>
            <label>
              <span>年化理财回报率（%）</span>
              <div class="slider-group">
                <input type="range" id="retSlider" min="0" max="15" step="0.1" value="5.0" class="slider" />
                <input type="number" id="ret" min="0" step="0.1" value="5.0" required class="slider-number" />
              </div>
            </label>
          </div>
          <div class="actions">
            <button type="submit">计算</button>
            <button type="reset" id="reset">重置</button>
          </div>
        </form>

        <div class="result">
          <div class="result-hero">
            <span class="result-hero-label">每月可支配收入（以今日购买力）<span class="info" data-tip="按真实收益率计算的固定月金额，用今天的价格度量；名义金额会随通胀逐月增长。">?</span></span>
            <div class="result-hero-value">
              <strong id="monthly">—</strong>
              <span class="result-hero-annual" id="monthlyAnnual"></span>
            </div>
          </div>
          <div id="reverseGroup" class="reverse-group" style="display:none;">
            <div class="reverse-title muted">目标反推结果 <span class="exchange-rate" id="exchangeRateDisplay"></span></div>
            <div class="reverse-cards">
              <div class="reverse-card reverse-card-today">
                <span class="reverse-card-label">现在需要本金 <span class="info" data-tip="如果现在有这么多钱，按设定的收益率增长到退休时，刚好能支撑你的目标开销。">?</span></span>
                <strong id="requiredSavings">—</strong>
                <span class="reverse-card-usd" id="requiredSavingsUsd"></span>
                <span class="reverse-card-sub">按收益增长到退休</span>
              </div>
              <div class="reverse-card reverse-card-retire">
                <span class="reverse-card-label">退休时账户余额 <span class="info" data-tip="退休那天银行账户显示的数字（名义值），已包含通胀。">?</span></span>
                <strong id="requiredAtRetire">—</strong>
                <span class="reverse-card-usd" id="requiredAtRetireUsd"></span>
                <span class="reverse-card-sub">银行账户显示金额</span>
              </div>
            </div>
          </div>
        </div>

        <div class="reverse-inputs">
          <div class="reverse-title muted">目标反推</div>
          <div class="grid">
            <label>
              <span>期望月开销（今日购买力）</span>
              <input type="text" id="desiredMonthly" inputmode="numeric" placeholder="例如 15,000" />
              <span class="format-hint" id="desiredMonthlyHint"></span>
            </label>
            <label>
              <span>目标退休年龄（岁）</span>
              <input type="number" id="retireAge" min="0" step="1" placeholder="留空则默认=当前年龄" />
            </label>
          </div>
          <div class="actions">
            <button type="button" id="reverseBtn">推测所需存款</button>
          </div>
        </div>
      </section>

      <section class="card">
        <h2>月度收入与资产余额</h2>
        <div class="chart-actions">
          <div class="share-wrapper">
            <button type="button" id="shareBtn">🔗 分享</button>
            <div class="share-panel" id="sharePanel">
              <div class="share-panel-header">分享给朋友</div>
              <div class="share-qr" id="shareQr"></div>
              <div class="share-qr-tip">微信扫码打开</div>
              <div class="share-options">
                <button type="button" id="copyLink" class="share-option">
                  <span class="share-icon">📋</span>
                  <span>复制链接</span>
                </button>
                <button type="button" id="shareWechatMoments" class="share-option">
                  <span class="share-icon">🟢</span>
                  <span>朋友圈</span>
                </button>
                <button type="button" id="shareWechatFriend" class="share-option">
                  <span class="share-icon">💬</span>
                  <span>微信好友</span>
                </button>
                <button type="button" id="shareXiaohongshu" class="share-option">
                  <span class="share-icon">📕</span>
                  <span>小红书</span>
                </button>
              </div>
              <div class="share-tip" id="shareTip"></div>
            </div>
          </div>
          <button type="button" id="exportPng">📷 导出图片</button>
        </div>
        <canvas id="balanceChart" height="140"></canvas>
      </section>
    </main>

    <footer>
      <small>当前模型假设在预期寿命末期余额（购买力）为 0。</small>
    </footer>

    <!-- 图片预览模态框 -->
    <div id="imageModal" class="image-modal">
      <div class="image-modal-content">
        <div class="image-modal-tip">👆 长按图片保存到相册</div>
        <img id="imageModalImg" src="" alt="财务自由计算器">
        <button type="button" id="imageModalClose" class="image-modal-close">← 返回</button>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <script type="module" src="app.js"></script>
  </body>
</html>
