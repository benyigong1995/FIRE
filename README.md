# 财务自由计算器（CLI + Web）

给定你的当前年龄、当前存款、预期寿命、年化通胀率、年化名义理财回报率，计算在剩余寿命内可持续的、以今日购买力计的每月可支配收入。

- 计算基于“真实收益率”的有限期年金公式：
  - 真实年化收益率 \( r = \frac{1+R}{1+\pi} - 1 \)，其中 \( R \) 为名义年化回报率，\( \pi \) 为年化通胀率。
  - 月度真实收益率 \( r_m = (1+r)^{1/12} - 1 \)。
  - 月数 \( N = 12 \times (\text{预期寿命}-\text{当前年龄}) \)。
  - 每月可支配收入（以今日购买力计）：\( w = PV \cdot \dfrac{r_m}{1 - (1+r_m)^{-N}} \)，当 \( r_m \approx 0 \) 时用 \( w \approx PV/N \)。

## 运行环境
- Python 3.8+
 - 现代浏览器（支持 ES Modules）

## CLI 使用方法
在项目目录中执行：

```bash
python3 freedom_calc.py \
  --age 30 \
  --savings 1000000 \
  --life 90 \
  --inflation 2.5 \
  --return 5
```

示例输出：

```text
每月可支配收入（以今日购买力计）：¥X,XXX.XX
```

## 参数说明
- `--age`: 当前年龄（岁）
- `--savings`: 当前存款（货币单位）
- `--life`: 预期寿命（岁）
- `--inflation`: 年化通胀率（百分数，如 2.5 表示 2.5%）
- `--return`: 年化名义理财回报率（百分数，如 5 表示 5%）

## 说明与假设
- 输出金额为“以今日购买力计”，便于和当前物价水平对照。
- 模型假设“每月固定金额”领取到预期寿命末尾，终值为 0。
- 若需要留有期末资产或考虑不规则现金流，可在公式基础上自行扩展。
- 本工具不构成投资建议。

---

## Web 版

### 快速启动

1. 在项目根目录启动本地服务器（避免 file:// 下 ES Modules 被拦截）：

```bash
python3 -m http.server 8000
```

2. 浏览器访问：

```
http://localhost:8000/web/index.html
```

页面会自动读取默认值并绘制图表。若直接用 file:// 打开，由于浏览器的模块安全策略，脚本不会执行。

### 文件结构

```
web/
  index.html        # 页面结构，使用 ES Modules 加载
  styles.css        # 页面样式
  config.js         # 全局配置：颜色/字号、对数轴范围、默认 DOB
  calc.js           # 计算与格式化：利率换算、收入与资产序列、货币与万/亿格式
  chart.js          # 图表渲染：双纵轴（左线性-收入，右对数-资产）
  app.js            # 交互逻辑：读取表单、校验、首绘、触发重绘
```

### 默认值与口径

- 默认生日：1995-01-12（加载时自动计算当前年龄并写入）
- 默认年化通胀率：3.0
- 默认年化理财回报率：5.0
- 图表展示为“名义金额”口径：
  - 月收入：在真实安全收入基础上按通胀递增
  - 资产：按名义回报推进
- 横轴：年龄（按月计算，以整岁每 5 年显示刻度）
- 右轴（资产）：对数刻度，固定范围 [1万, 1亿]，零值在图上以下限绘制（Tooltip 显示“已耗尽”）


### 目标反推

在 Web 页中可填写：

- 期望月开销（今日购买力）
- 目标退休年龄（可留空=当前年龄）

系统将反推“所需当前存款（今日购买力）”。
方法：
1) 基于真实收益率在退休后区间计算使余额终值为 0 的退休时点所需 PV；
2) 将该 PV 以真实年化收益折现回今天。

### 常见问题（FAQ）

- 页面为空、无曲线或“—”不显示数值？
  - 请确保通过 `http://localhost:8000/web/index.html` 打开，而不是 file:// 路径。
  - 浏览器需支持 ES Modules（现代 Chrome/Edge/Safari/Firefox 均可）。

- 想要自动联动输入实时重绘？
  - 目前点击“计算”触发。可在 `app.js` 中为输入绑定 input 事件并节流（如 150ms）。

- 想调整资产对数轴范围或配色/字号？
  - 在 `web/config.js` 中修改 `assetLogAxis` 和 `chartColors/chartFont`。

